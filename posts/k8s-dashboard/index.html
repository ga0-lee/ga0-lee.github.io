<!DOCTYPE html><html lang="en" ><head> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2093656452178150" crossorigin="anonymous"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="EKS에 Kubernetes Dashboard 배포하기" /><meta name="author" content="garit" /><meta property="og:locale" content="en" /><meta name="description" content="EKS에 Kubernetes Dashboard 배포하기" /><meta property="og:description" content="EKS에 Kubernetes Dashboard 배포하기" /><link rel="canonical" href="https://ga0-lee.github.io/posts/k8s-dashboard/" /><meta property="og:url" content="https://ga0-lee.github.io/posts/k8s-dashboard/" /><meta property="og:site_name" content="Garit!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-15T10:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="EKS에 Kubernetes Dashboard 배포하기" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"garit"},"dateModified":"2022-12-27T17:26:38+09:00","datePublished":"2022-11-15T10:00:00+09:00","description":"EKS에 Kubernetes Dashboard 배포하기","headline":"EKS에 Kubernetes Dashboard 배포하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://ga0-lee.github.io/posts/k8s-dashboard/"},"url":"https://ga0-lee.github.io/posts/k8s-dashboard/"}</script><title>EKS에 Kubernetes Dashboard 배포하기 | Garit!</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Garit!"><meta name="application-name" content="Garit!"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/cotes2020/chirpy-images/main/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Garit!</a></div><div class="site-subtitle font-italic">Record what I understand of</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ga0-lee" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['lleun8956','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>EKS에 Kubernetes Dashboard 배포하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>EKS에 Kubernetes Dashboard 배포하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1668474000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 15, 2022 </em> </span> <span> Updated <em class="" data-ts="1672129598" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 27, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> ga0-lee </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1367 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h2 id="eks에-kubernetes-dashboard-배포하기"><span class="mr-2">EKS에 Kubernetes Dashboard 배포하기</span><a href="#eks에-kubernetes-dashboard-배포하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="상황"><span class="mr-2">상황</span><a href="#상황" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>AWS EKS에 Kubernetes Dashboard를 배포하여 관리하고자 한다.<br /> <br /></p><p>현 사이트의 경우 보안상의 이유로 Proxy를 통해 Kubernetes Dashboard에 접속해야 한다.<br /> <br /></p><p>그래서 아래와 같은 경로를 통해 Kubernetes Dashboard Pod에 도달하게 된다.</p><blockquote><p>PC -&gt; Proxy Server(Nginx) -&gt; Ingress Controller -&gt; Ingress -&gt; Kubernetes Dashboard Service -&gt; Kubernetes Dashboard Pod <br /></p></blockquote><p>Kubernetes Dashboard는 무조건 https로 접속해야 하는데 앞쪽의 Ingress 또는 Proxy server 등에서 ssl 처리를 해주면 Kubernetes Dashboard 자체는 http로 설정이 가능하다.<br /> <br /></p><p>그래서 나는 제일 앞단에 있는 Nginx에 ssl 설정을 해줄 것이다.</p><h3 id="kubernetes-dashboard-배포하기"><span class="mr-2">Kubernetes Dashboard 배포하기</span><a href="#kubernetes-dashboard-배포하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>먼저 Kubernetes Dashboard를 배포해보자.<br /> <br /></p><p><strong>1.Kubernetes Dashboard yaml 파일을 다운받는다.</strong></p><blockquote><p>wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.0/aio/deploy/recommended.yaml -O k8s-dashboard.yaml</p></blockquote><p><strong>2.아래와 같이 포트 및 옵션을 수정하여 배포한다.</strong></p><ul><li>포트는 편의를 위해 모두 8001로 변경한다.<li>아래의 예시는 수정할 부분만 가져온 것이다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>                  <span class="c1"># 포트 수정</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8001</span>            <span class="c1"># 포트 수정</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">seccompProfile</span><span class="pi">:</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">RuntimeDefault</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">kubernetesui/dashboard:v2.7.0</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8001</span>                 <span class="c1"># 포트 수정</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="c1">#- --auto-generate-certificates       # 주석 처리</span>
            <span class="pi">-</span> <span class="s">--namespace=kubernetes-dashboard</span>    <span class="c1"># namespace를 설정한다</span>
<span class="err">			</span><span class="pi">-</span> <span class="s">--insecure-bind-address=0.0.0.0</span>     <span class="c1"># 모든 http 접속을 허용한다 (추가)</span>
            <span class="pi">-</span> <span class="s">--enable-insecure-login</span>             <span class="c1"># http 로그인 허용한다 (추가)</span>
            <span class="pi">-</span> <span class="s">--token-ttl=10800</span><span class="err">	</span><span class="s"># 토큰 세션 유지시간 - 선택 사항임</span>
            <span class="c1"># Uncomment the following line to manually specify Kubernetes API server Host</span>
            <span class="c1"># If not specified, Dashboard will attempt to auto discover the API server and connect</span>
            <span class="c1"># to it. Uncomment only if the default does not work.</span>
            <span class="c1"># - --apiserver-host=http://my-address:port</span>
<span class="err">          </span><span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard-certs</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/certs</span>
              <span class="c1"># Create on-disk volume to store exec logs</span>
            <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-volume</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span>   <span class="c1"># http로 변경</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>     <span class="c1"># 포트 수정</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
            <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">30</span>
</pre></table></code></div></div><p>위와 같이 변경한 후 배포한다.</p><blockquote><p>kubectl apply -f k8s-dashboard.yaml</p></blockquote><p><br /></p><h3 id="kubernetes-dashboard용-ingress-배포하기"><span class="mr-2">Kubernetes Dashboard용 Ingress 배포하기</span><a href="#kubernetes-dashboard용-ingress-배포하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>위에서 배포한 Kubernetes Dashboard로 라우팅 되도록 Ingress를 배포한다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span> 
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">k8s-dashboard.com</span>
    <span class="na">http</span><span class="pi">:</span>  
<span class="err">	</span>  <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="s">9090</span><span class="err">		</span>  
        <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
        <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>

</pre></table></code></div></div><blockquote><p>kubectl apply -f k8s-dashboard-ingress.yaml<br /> <br /></p></blockquote><h3 id="kubernetes-dashboard에-eks-권한-부여하기"><span class="mr-2">Kubernetes Dashboard에 EKS 권한 부여하기</span><a href="#kubernetes-dashboard에-eks-권한-부여하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>기본적으로 Kubernetes Dashboard 사용자의 권한은 제한되어 있다.<br /> <br /></p><p>그래서 eks-admin이라는 이름으로 Service Account 및 Cluster Role Binding를 생성하고, 이를 사용하여 관리자 권한으로 Dashboard에 연결할 것이다.<br /> <br /></p><p>아래와 같이 Service Account와 Cluster Role Binding를 생성한다. <br /> <br /></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eks-admin</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eks-admin</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cluster-admin</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eks-admin</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
</pre></table></code></div></div><blockquote><p>kubectl apply -f eks-admin-service-account.yaml<br /> <br /></p></blockquote><h3 id="nginx에-ssl-설정하기"><span class="mr-2">Nginx에 ssl 설정하기</span><a href="#nginx에-ssl-설정하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Kubernetes Dashboard는 무조건 https 통신이 돼야 하는데 이를 nginx에서 처리할 수도 있다.<br /> <br /></p><p>그래서 openssl 명령어로 사설 인증서를 생성한 후 Nginx에 ssl 설정을 해보자.<br /> <br /></p><ul><li>openssl 명령어로 key 발급하기</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># private key와 인증서를 발급한다. 아래 명령어를 입력하면 국가부터 회사까지 각종 정보를 입력해야 한다.</span>
<span class="nv">$ </span>openssl req <span class="nt">-new</span> <span class="nt">-newkey</span> rsa:2048 <span class="nt">-nodes</span> <span class="nt">-keyout</span> k8s-dashboard.key <span class="nt">-out</span> k8s-dashboard.csr

<span class="c"># 위에서 발급한 private key와 csr 키를 통해 crt 키를 발급한다.</span>
<span class="nv">$ </span>openssl x509 <span class="nt">-req</span> <span class="nt">-days</span> 365 <span class="nt">-in</span> k8s-dashboard.csr <span class="nt">-signkey</span> k8s-dashboard.key <span class="nt">-out</span> k8s-dashboard.crt

</pre></table></code></div></div><p><br /></p><ul><li>Nginx에 ssl 설정하기</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>upstream k8s-dashboard <span class="o">{</span>
  least_conn<span class="p">;</span>
  <span class="c"># Ingress Controller Service IPs</span>
  server 10.123.45.678:80<span class="p">;</span>
  server 10.123.45.679:80<span class="p">;</span>
<span class="o">}</span>
server <span class="o">{</span>
        <span class="c"># ssl on 대신 listen 구문 마지막에 ssl을 넣는 것으로 변경됨.</span>
        listen 443 ssl<span class="p">;</span>
        server_name k8s-dashboard.com<span class="p">;</span>
        charset utf-8<span class="p">;</span>
		
        access_log /etc/nginx/log/access.log<span class="p">;</span>
        error_log /etc/nginx/log/error.log<span class="p">;</span>
        
		<span class="c">#ssl 인증서 적용</span>
        ssl_certificate /etc/nginx/ssl/k8s-dashboard.crt<span class="p">;</span>        <span class="c">#생성된 인증서경로</span>
        ssl_certificate_key /etc/nginx/ssl/k8s-dashboard.key<span class="p">;</span>    <span class="c">#생성된 개인키</span>
        
		location / <span class="o">{</span>
                proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
                proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
                proxy_set_header X-Scheme <span class="nv">$scheme</span><span class="p">;</span>
				
                proxy_pass http://k8s-dashboard<span class="p">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>Host 설정하기<br /> <br /></ul><p>nginx에 ssl 설정까지 마쳤으면 이제 hosts 파일에 설정한 Kubernetes Dashboard 도메인과 Nginx 서버 IP를 매핑해줘야 한다.<br /> <br /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>vi /etc/hosts

<span class="c"># 웹서버 IP      # Kubernetes Dashboard 도메인</span>
10.111.22.333  k8s-dashboard.com
</pre></table></code></div></div><h3 id="kubernetes-dashboard에-접속하기"><span class="mr-2">Kubernetes Dashboard에 접속하기</span><a href="#kubernetes-dashboard에-접속하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>주의사항: 반드시 https로 접속해야 한다.<br /> <br /></p><p>위에서 설정한 도메인으로 접속하면 아래와 같은 UI가 뜬다.</p><blockquote><p>https://k8s-dashboard.com<br /> <br /></p></blockquote><p><img data-src="https://user-images.githubusercontent.com/67899732/209635254-b6a71ca7-6c97-49fc-8928-7624d078984f.png" alt="k8s" data-proofer-ignore></p><p>로그인은 위에서 생성한 eks-admin token 값으로 로그인을 할 것이다.<br /> <br /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>
<span class="c"># Token 확인 명령어</span>
kubectl <span class="nt">-n</span> kube-system describe secret <span class="si">$(</span>kubectl <span class="nt">-n</span> kube-system get secret | <span class="nb">grep </span>eks-admin | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span>

<span class="c"># 출력 예시</span>
Name:         eks-admin-token-b5zv4
Namespace:    kube-system
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name<span class="o">=</span>eks-admin
              kubernetes.io/service-account.uid<span class="o">=</span>bcfe66ac-39be-11e8-97e8-026dce96b6e8

Type:  kubernetes.io/service-account-token

Data
<span class="o">====</span>
ca.crt:     1025 bytes
namespace:  11 bytes
token:      &lt;token 값&gt;
</pre></table></code></div></div><ul><li>위에서 출력된 token 값을 복사하여 로그인 한다.<br /> <br /></ul><p><img data-src="https://user-images.githubusercontent.com/67899732/209636495-c85dadaa-68dd-48cb-9690-0c7ec7efec06.png" alt="k8s2" data-proofer-ignore></p><ul><li>로그인 하면 위와 같은 화면이 뜬다. 여기서 원하는 리소스를 골라 확인할 수 있다.<br /> <br /></ul><p>끝.</p><p>참고</p><ul><li>[https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/dashboard-tutorial.html] (https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/dashboard-tutorial.html)<li>[https://csupreme19.github.io/devops/kubernetes/2021/03/04/kubernetes-dashboard.htm] (https://csupreme19.github.io/devops/kubernetes/2021/03/04/kubernetes-dashboard.html)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/cases/'>Cases</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/k8s/" class="post-tag no-text-decoration" >k8s</a> <a href="/tags/eks/" class="post-tag no-text-decoration" >eks</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=EKS%EC%97%90+Kubernetes+Dashboard+%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0+-+Garit%21&url=https%3A%2F%2Fga0-lee.github.io%2Fposts%2Fk8s-dashboard%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=EKS%EC%97%90+Kubernetes+Dashboard+%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0+-+Garit%21&u=https%3A%2F%2Fga0-lee.github.io%2Fposts%2Fk8s-dashboard%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fga0-lee.github.io%2Fposts%2Fk8s-dashboard%2F&text=EKS%EC%97%90+Kubernetes+Dashboard+%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0+-+Garit%21" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/k8s-cp-ownership-error/">kubectl cp 명령어 ownership 에러 해결하기</a><li><a href="/posts/k8s-dashboard/">EKS에 Kubernetes Dashboard 배포하기</a><li><a href="/posts/k8s-java-heap-setting/">Java 기반 Pod에 Heap Memory 설정하기</a><li><a href="/posts/vim-backup-error/">vim 에러 Cannot create backup file(add ! to overwrite) 해결하기</a><li><a href="/posts/k8s-image-pull-error/">K8s Pod 이미지 Pull 에러 해결방안</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/eks/">eks</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/iac/">iac</a> <a class="post-tag" href="/tags/nginx/">nginx</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/argocd/">ArgoCD</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/k8s-image-pull-error/"><div class="card-body"> <em class="small" data-ts="1668649200" data-df="ll" > Nov 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>K8s Pod 이미지 Pull 에러 해결방안</h3><div class="text-muted small"><p> K8s Pod 이미지 Pull 에러 해결방안 상황 Jenkins 파이프라인을 지우고 다시 생성하면서 버전이 같은 이미지가 생성되었다. ECR에서는 같은 버전의 이미지가 push 되면 기존에 있던 이미지를 untagged로 바꾸고 새로 push된 이미지를 해당 버전으로 표기하여 저장한다. 그러나 EKS에서 해당 버전으로 배포를 다시 했더니 새로 빌드...</p></div></div></a></div><div class="card"> <a href="/posts/k8s-pod-tz-setting/"><div class="card-body"> <em class="small" data-ts="1668911400" data-df="ll" > Nov 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>K8s Pod에 Time Zone 설정하기</h3><div class="text-muted small"><p> K8s Pod에 Time Zone 설정하기 상황 생성된 Pod의 로그를 kubectl logs 명령어로 확인하면 로그가 찍히는 시간이 현재 시간과 달라 에러를 디버깅할 때 어려움이 생겼다. 그래서 Pod에 접속하여 /etc/localtime 을 확인해보니 UTC로 되어있었다. 해결방안 Pod에 Time Zone을 설정해서 한국 표준 시간으로 ...</p></div></div></a></div><div class="card"> <a href="/posts/k8s-java-heap-setting/"><div class="card-body"> <em class="small" data-ts="1668992400" data-df="ll" > Nov 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java 기반 Pod에 Heap Memory 설정하기</h3><div class="text-muted small"><p> Java 기반 Pod에 Heap Memory 설정하기 상황 성능테스트를 하던 도중 원하는 목표치에 도달하기도 전에 OOM(Out of Memory) 에러가 발생하여 Java 기반의 Pod의 Heap 사이즈를 변경해달라는 요청을 받아 변경하려 한다. 해결 방법 아래와 같이 java 실행 명령어에 HEAP_OPT 값을 주어 app.jar를 실행시...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/helm-basic/" class="btn btn-outline-primary" prompt="Older"><p>helm 개념 및 기본 사용법</p></a> <a href="/posts/vim-backup-error/" class="btn btn-outline-primary" prompt="Newer"><p>vim 에러 Cannot create backup file(add ! to overwrite) 해결하기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2093656452178150" crossorigin="anonymous"></script><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ga0-lee">ga0-lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/eks/">eks</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/iac/">iac</a> <a class="post-tag" href="/tags/nginx/">nginx</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/argocd/">ArgoCD</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
