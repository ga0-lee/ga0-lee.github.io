---
title: Terraform으로 Infra 구성하기 No.4(Terraform - Attribute/Dependency/Output)
author: garit
date: 2022-05-10 11:00:00 +0900
categories: [IaC, Terraform]
tags: [iac, terraform]
render_with_liquid: false
---

## Resource Attribute
---
- Resource의 argument 값을 다른 resource의 argument 값으로 지정할 수 있다.

[main.tf]

    resource "local_file" "pet" {
    filename = var.filename
    content = "My favorite pet is ${random_pet.my-pet.id}"
    }
    
    resource "random_pet" "my-pet" {
    prefix = var.prefix
    separator = var.separator
    length = var.length
    }

=> `random_pet`인 `my-pet resource`의 `id`를 `local_file`인 `pet resource`의 `content` 값으로 넣어주었다.  
- config 파일에는 `my-pet`의 id가 없지만 `terraform apply`를 실행할 경우 `random` provider는 지정해준 `argument`들을 가지고 id를 만든다.


## Resource Dependencies
---
### Implicit Dependency
[main.tf]

    resource "local_file" "pet" {
    filename = var.filename
    content = "My favorite pet is ${random_pet.my-pet.id}"
    }
    
    resource "random_pet" "my-pet" {
    prefix = var.prefix
    separator = var.separator
    length = var.length
    }

- `${random_pet.my-pet.id}` 과 같은 표현을 사용하여 다른 resource의 `argument` 값을 가져다 쓸 수 있다.
- `terraform apply` 를 실행하게 되면 random_pet인 `my-pet`이 먼저 생성되고 그 다음으로 local_file인 `pet`이 생성된다. 삭제의 경우에는 그 반대.
- 이렇게 의존성을 갖게 하는 표현을 사용하여 의존성이 생기는 경우를 **Implicit Dependency** (암시적 의존성)라고 한다.

### Explicit Dependency
[main.tf]

    resource "local_file" "pet" {
    filename = var.filename
    content = "My favorite pet is my dog"
	depends_on = [
	  random_pet.my-pet
	]
    }
    
    resource "random_pet" "my-pet" {
    prefix = var.prefix
    separator = var.separator
    length = var.length
    }

- 위와 같이 `depends_on`으로 의존성을 직접 명시하여 `local_file.pet`이 `random_pet.my-pet` 보다 나중에 생기게 할 수 있다.
- 이렇게 직접 명시하여 의존성을 정하는 경우 **Explicit Dependency** (명시적 의존성) 라고 한다.

## Output Variable
---
- Output Variable을 사용하면 Provisioning된 Resource의 세부사항을 빠르게 확인할 수 있다.
- Ansible이나 Shell script의 config에서 사용할 수 있다.

**[예시]**

[main.tf]

    resource "random_pet" "my-pet" {
      length = var.length 
    }
    
    output "pet-name" {
      value = random_pet.my-pet.id
      description = "Record the value of pet ID generated by the random_pet resource"
    }
    
    resource "local_file" "welcome" {
      filename = "/root/message.txt"
      content = "Welcome to Kodekloud."
    }
    
    output "welcome_message" {
      value = local_file.welcome.content
      description = "Welcome message from local_file welcome"
    }

[variable.tf]

    variable "prefix" {
      default = "Mrs"
    }
    
    variable "separator" {
            default = "."
    }
    
    variable "length" {
            default = "1"
    }

- `output` 블럭을 생성하여 출력할 `variable`을 지정한다.
- `terraform init -> terraform plan -> terraform apply` 로 적용하면 `output` 값도 출력된다.
- `terraform output`을 통해 `output` 블럭에서 지정한 값을 확인할 수 있다.
	- 명령어 실행 결과

            iac-server $ terraform output
            pet-name = ant
            welcome_message = Welcome to Kodekloud.